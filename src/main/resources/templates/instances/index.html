<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>인스턴스</title>

</head>
<style>

    .table_container {
        display: flex;
        flex-direction: column;
        margin-top : 90px;
        margin-bottom: 35px;
    }

    .table_title_container {
        display: flex;
        align-items: center;
        padding: 0px;
        padding: 5px 16px 0px;
        justify-content: space-between;
        height: 35px;
        background-color: #F4572F;
        margin-bottom: 16px;
    }

    .instance_checkbox {
        font-size: 12px;
        text-align: center;
        text-decoration: none;
        height: 25px;
        margin-right: 4px;
    }

    .table_title {
        font-weight: 700;
        margin: 0;
        color: white;
        font-size: 20px;
        font-family: 'Noto Sans KR', sans-serif;
    }

    .table_head_container {
        display: flex;
        flex-direction: row;
        justify-content: space-evenly;
        text-align: center;
        height: 40px;
        border-bottom: 2px solid #d3d3d3;
    }

    .table_head_container div {
        font-size: 13px;
        padding-top: 5px;
        font-weight: 400;
        font-family: 'Noto Sans KR', sans-serif;
    }

    .instance_table {
        border-bottom: 2px solid #d3d3d3;
    }

    .instance_table_title_container {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        vertical-align: middle;
        height: 35px;
        background-color: black;
    }

    .instance_table_title {
        font-size: 20px;
        font-weight: 700;
        color: white;
        font-family: 'Noto Sans KR', sans-serif;
    }

    .table_odd_row {
        display: flex;
        height: 35px;
        flex-direction: row;
        align-items: center;
        background-color: #F9F7F9;
    }

    .table_even_row {
        display: flex;
        height: 35px;
        flex-direction: row;
        align-items: center;
    }

    .instance_option_container {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: flex-end;
    }

    .table_instance_option_container {
        height: 35px;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: flex-end;
        background-color: #ffde3a;
    }

    .instance_option_button {
        font-size: 11px;
        text-align: center;
        text-decoration: none;
        height: 20px;
    }

    .table_odd_row_title {
        width: 120px;
        padding-top: 5px;
        border-right: 1px solid #d3d3d3;
        margin-right: 16px;
        font-size: 14px;
        font-weight: 400;
        font-family: 'Noto Sans KR', sans-serif;
        background-color: #F9F7F9;
        text-align: center;
    }

    .table_even_row_title {
        width: 120px;
        padding-top: 5px;
        border-right: 1px solid #d3d3d3;
        margin-right: 16px;
        font-size: 14px;
        font-weight: 400;
        font-family: 'Noto Sans KR', sans-serif;
        text-align: center;
    }

    .table_odd_row_content {
        padding-top: 5px;
        font-size: 12px;
        font-weight: 300;
        font-family: 'Noto Sans KR', sans-serif;
        text-align: center;
        vertical-align: middle;
        background-color: #F9F7F9;
    }

    .table_even_row_content {
        padding-top: 5px;
        font-size: 12px;
        font-weight: 300;
        font-family: 'Noto Sans KR', sans-serif;
        text-align: center;
        vertical-align: middle;
    }

    .even_checkbox {
        position: absolute;
        left: 20px;
        background-color: #F9F7F9;
    }

    .odd_checkbox {
        position: absolute;
        left: 20px;
    }


</style>

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400&display=swap" rel="stylesheet">

<!-- HEADER -->
<script>

    $(document).ready(function () {

        $("#top_nav").load("/topNav");
    });

    var selectedList = new Set();

    function onClickCheckBox(self) {
        var instanceId = self.id;
        if (selectedList.has(instanceId)) {
            selectedList.delete(instanceId);
        } else {
            selectedList.add(instanceId);
        }
    }

    function deleteInstances(self) {
        var arr = Array.from(selectedList);
        for (var i=0; i < arr.length; i++) {
            var result = $.ajax({
                url: "/instances/instance/"+arr[i],
                dataType: "text",
                method: "DELETE"
            }).done(function (data) {
                console.log("인스턴스 삭제 완료");
            }).fail(function (a, status, error) {
                alert("서버 에러 발생" + JSON.stringify(a) + ",  " + status + ", " + error)
            });
        }
        location.reload();
    }

</script>

<body>
<div id="top_nav"></div>
<div th:class="table_container">
    <div th:class="table_title_container">
        <span th:class="table_title">내 인스턴스 리스트</span>
        <div th:class="instance_option_container">
            <input type="button" class="instance_checkbox" onclick="location.href='/instance/create'" value="인스턴스 생성">
            <input type="button" class="instance_checkbox" onclick="deleteInstances(this)" value="선택삭제">
        </div>
    </div>
    <div th:class="table_container">
        <div th:class="instance_table" th:each="instance, stat : ${instanceList}">
            <div th:class="${stat.odd} ?  'even_checkbox' : 'table_even_item'">
            </div>
            <div th:class="instance_table_title_container">
                <input th:id="${instance.instanceId}" type="checkbox" onclick="onClickCheckBox(this)">
                <span th:class="instance_table_title" th:text="${instance.instanceName}"></span>
            </div>
            <div class="table_even_row">
                <div th:class="table_even_row_title">인스턴스 아이디</div>
                <div th:class="table_even_row_content"
                     th:text="${instance.instanceContainerId}"></div>
            </div>
            <div class="table_odd_row">
                <div th:class="table_odd_row_title">인스턴스 해쉬</div>
                <div th:class="table_odd_row_content"
                     th:text="${instance.instanceHash}"></div>
            </div>
            <div class="table_even_row">
                <div th:class="table_even_row_title">이미지</div>
                <div th:class="table_even_row_content"
                     th:text="${instance.containerImageNickName}"></div>
            </div>
            <div class="table_odd_row">
                <div th:class="table_odd_row_title">상태</div>
                <div th:class="table_odd_row_content"
                     th:text="${instance.status}"></div>
            </div>
            <div class="table_even_row">
                <div th:class="table_even_row_title">자원</div>
                <div th:class="table_even_row_content"
                     th:text="${instance.resources}"></div>
            </div>
            <div class="table_odd_row">
                <div th:class="table_odd_row_title">외부접속IP</div>
                <div th:class="table_odd_row_content"
                     th:text="${instance.externalIP}"></div>
            </div>
            <div class="table_even_row">
                <div th:class="table_even_row_title">외부노출포트</div>
                <div th:class="table_even_row_content"
                     th:text="${instance.externalPorts}"></div>
            </div>
            <div class="table_odd_row">
                <div th:class="table_odd_row_title">내부접속IP</div>
                <div th:class="table_odd_row_content"
                     th:text="${instance.internalIP}"></div>
            </div>
            <div class="table_even_row">
                <div th:class="table_even_row_title">내부노출포트</div>
                <div th:class="table_even_row_content"
                     th:text="${instance.internalPorts}"></div>
            </div>
            <div class="table_odd_row">
                <div th:class="table_odd_row_title">사용기간</div>
                <div th:class="table_odd_row_content"
                     th:text="${instance.period}"></div>
            </div>
            <!--
            <div class="table_instance_option_container">
                <input type="button" class="instance_option_button" value="삭제">
            </div>
            -->
        </div>
    </div>
</div>

<!-- FOOTER -->
</body>
</html>