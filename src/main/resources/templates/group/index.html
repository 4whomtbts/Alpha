<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4" xmlns:layout="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <title>그룹</title>
</head>
<body>
<div layout:fragment="content"/>
<form th:action="${'/login'}"></form>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<meta name="_csrf" data-th-content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
<style>
    input {
        display: block;
        font-size: 11px;
        padding: 4px 2px;
        border: solid 1px #aacfe4;
        width: 200px;
        margin: 2px 0 20px 10px;
    }
</style>

<script>
    var csrf;
    $(document).ready(function () {
        //csrf = JSON.parse('[[${_csrf}]]');
        var csrfParameter = $('meta[name="_csrf_parameter"]').attr('content')
        var csrfHeader = $('meta[name="_csrf_header"]').attr('content')
        var csrfToken = $('meta[name="_csrf"]').attr('content')

        $.ajaxSetup({
            beforeSend: function (xhr) {
            }
        });
        $("#create_group_button").on('click', function () {
            var groupName = $("#groupName").val();
            var representative = $("#representative").val();
            $.ajax({
                url: "/groups/group/",
                type: "POST",
                contentType: 'application/json',
                dataType: "json",
                cache: false,
                data: JSON.stringify({
                    "groupName": groupName,
                    "representative": representative
                }),
                beforeSend: function (xhr) {
                    xhr.setRequestHeader(csrfHeader, csrfToken);
                },
                success: function (res) {
                    console.log(res);
                },
                error: function (jqXHR, status, e) {
                    alert("실패하였습니다. 재시도 혹은 문의해주세요." + JSON.stringify(jqXHR) + ", " + status + " : " + e);
                }
            });
        })
    })

</script>
<h1>그룹</h1>
<hr>
<th:block th:if="${groups.size()==0}">
    <span> 소속된 그룹이 존재하지 않습니다!</span>
    <p> 그룹 생성하기 </p>
    <label> 그룹이름 </label><input type="text" id="groupName" placeholder="동국대학교 인공지능연구원">
    <label> 대표자 이름 </label><input type="text" id="representative" placeholder="김동국">
    <input id="create_group_button" type="button" value="생성요청">
</th:block>
<th:block th:if="${groups!=null}">
    <div th:each="elem, out: ${groups}">
        <div id="group_name"><span th:text="${elem.group.groupName}"> </span></div>
        <p> 가입대기 </p>
        <div id="group_member_container">
            <div>
                <div th:each="curr : ${notAcceptedMemberLists[__${out.index}__]}" th:class="requested_join_user_container">
                    <div th:text="${curr.getUser().getLoginId()}"></div>
                    <div th:text="${curr.getUser().getUserName()}"></div>
                    <div th:text="${curr.getGroupUserType()}"></div>
                </div>
            </div>
            <p> 그룹원 </p>
            <div id="requested_join_user_container">
                <div>
                    <div th:each="curr : ${memberLists[__${out.index}__]}" th:class="accepted_member_container">
                        <div th:text="${curr.getUser().getLoginId()}"></div>
                        <div th:text="${curr.getUser().getUserName()}"></div>
                        <div th:text="${curr.getGroupUserType()}"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</th:block>

<table>
    <thead>

    </thead>
</table>

</body>
</html>